<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Botiga Online - El Nano Farinetes</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- üîù Navegaci√≥ -->
<nav>
  <!-- Logo amb enlla√ß a l'inici -->
  <div class="logo">
    <a href="index.html">El Nano Farinetes</a>
  </div>

  <ul>
    <li><a href="index.html#qui-soc">Qui s√≥c</a></li>
    <li><a href="index.html#tallers">Tallers</a></li>
    <li><a href="Calendari.html">Calendari</a></li>
    <li class="idioma-mobile">
      <button onclick="location.href='index.html'">CA</button>
      <button onclick="location.href='index-es.html'">ES</button>
    </li>
  </ul>

  <div class="nav-right">
    <!-- Idiomes en desktop -->
    <div class="idioma-desktop">
      <button onclick="location.href='index.html'">CA</button>
      <button onclick="location.href='index-es.html'">ES</button>
    </div>

    <!-- Botiga Online -->
    <a href="botiga.html" class="btn-botiga">Botiga Online</a>

    <!-- Men√∫ hamburguesa -->
    <div class="menu-toggle"><span></span><span></span><span></span></div>
  </div>
</nav>


  <!-- üõí Hero -->
  <header class="hero hero-small">
    <div class="hero-content">
      <h1>Botiga Online</h1>
      <p>Compra productes de temporada directament del camp</p>
    </div>
  </header>

  <!-- üõí Productes -->
  <section class="tallers">
    <h2>Productes disponibles</h2>
    <div id="llista-productes" class="tallers-container"></div>
  </section>

  <footer>
    <div class="social-icons">
      <a href="https://www.instagram.com/el_nano_farinetes" target="_blank" rel="noopener"><i class="fab fa-instagram"></i></a>
      <a href="https://www.facebook.com/elnanofarinetes" target="_blank" rel="noopener"><i class="fab fa-facebook"></i></a>
      <a href="mailto:elnanofarinetes@gmail.com"><i class="fas fa-envelope"></i></a>
    </div>
    <p>&copy; 2025 El Nano Farinetes</p>
  </footer>

  <script>
  const API = "https://elnanofarinetes-server.onrender.com";
  const cont = document.getElementById("llista-productes");

  async function carregaProductes() {
    try {
      const r = await fetch(`${API}/api/products?active=true`);
      const data = await r.json();
      if (!data.length) {
        cont.innerHTML = "<p>No hi ha productes disponibles actualment.</p>";
        return;
      }
      cont.innerHTML = data.map(p => `
        <div class="taller-card">
          <img src="${p.image_url || 'https://via.placeholder.com/400x300?text=Producte'}" 
               alt="${p.name_ca}" class="taller-img">
          <h3>${p.name_ca}</h3>
          <p>${p.description_ca || ""}</p>
          <p><strong>${(p.price_cents/100).toFixed(2)} ‚Ç¨</strong></p>
          ${p.stock > 0 
            ? `<button onclick="checkout(${p.id})">Comprar</button>` 
            : `<p style="color:red">Esgotat</p>`}
        </div>
      `).join("");
    } catch (e) {
      cont.innerHTML = "<p>Error carregant productes.</p>";
    }
  }

  async function checkout(productId) {
    const r = await fetch(`${API}/api/checkout`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ items: [{ id: productId, qty: 1 }] })
    });
    const { url } = await r.json();
    window.location = url;
  }

  carregaProductes();
  </script>
</body>
</html>
